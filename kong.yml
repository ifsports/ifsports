_format_version: "3.0"

services:
  - name: auth-service
    url: http://authapi:8000
    routes:
      - name: auth-public-login-route
        paths:
          - /api/v1/auth/token
          - /api/v1/auth/token/refresh
        strip_path: false
        preserve_host: true
      - name: auth-public-suap-callback-route
        paths:
          - /auth/suap/callback
        strip_path: false
        preserve_host: true
      - name: auth-public-validate-users-route
        methods:
          - POST
          - GET
        paths:
          - /api/v1/auth/users
        strip_path: false
        preserve_host: true
      - name: auth-protected-users-route
        paths:
          - /api/v1/auth/logout
          - /api/v1/auth/users/me
        plugins:
          - name: jwt
        strip_path: false
        preserve_host: true
      - name: auth-public-schema
        paths:
          - /docs/auth
        methods:
          - GET
        strip_path: true
        preserve_host: true

  - name: requests-service
    url: http://requestsapi:8001
    routes:
      - name: requests-protected-all
        paths:
          - /api/v1/requests
        plugins:
          - name: jwt
        strip_path: false
      - name: requests-public-schema
        paths:
          - /docs/requests
        methods:
          - GET
        strip_path: true

  - name: match-comments-service
    url: http://commentsapi:8002
    routes:
      - name: match-comments-public-read
        paths:
          - /api/v1/matches
          - /api/v1/chat
        methods:
          - GET
        strip_path: false
      - name: match-comments-protected-write
        paths:
          - /api/v1/matches
          - /api/v1/chat
        methods:
          - POST
          - PUT
          - PATCH
          - DELETE
        plugins:
          - name: jwt
        strip_path: false
      - name: comments-public-schema
        paths:
          - /docs/comments
        methods:
          - GET
        strip_path: true
      - name: socket-io-route
        paths:
          - /socket.io
          - /socket.io/
        strip_path: false
        plugins:
          - name: jwt

  - name: teams-service
    url: http://teamsapi:8003
    routes:
      - name: teams-public-list
        paths:
          - /api/v1/teams
        methods:
          - GET
        strip_path: false
      - name: teams-protected-actions
        paths:
          - /api/v1/teams
        methods:
          - POST
          - PUT
          - DELETE
          - PATCH
        plugins:
          - name: jwt
        strip_path: false
      - name: teams-public-schema
        paths:
          - /docs/teams
        methods:
          - GET
        strip_path: true

  - name: competitions-service
    url: http://competitionsapi:8007
    routes:
      - name: competitions-public-media
        paths:
          - /media
        methods:
          - GET
        strip_path: false
      - name: competitions-public-read
        paths:
          - /api/v1/competitions
          - /api/v1/modalities
        methods:
          - GET
        strip_path: false
      - name: competitions-protected-write
        paths:
          - /api/v1/competitions
          - /api/v1/modalities
        methods:
          - POST
          - PUT
          - DELETE
          - PATCH
        plugins:
          - name: jwt
        strip_path: false
      - name: competitions-protected-special-cases
        paths:
          - /api/v1/competitions/teams/
          - /api/v1/modalities/
        plugins:
          - name: jwt
        strip_path: false
      - name: competitions-public-schema
        paths:
          - /docs/competitions
        methods:
          - GET
        strip_path: true

  - name: audit-service
    # <<< CORREÇÃO: Apontando para a porta 8009, conforme definido no docker-compose.yml
    url: http://auditapi:8008
    routes:
      - name: audit-route
        paths:
          - /api/v1/campus
        plugins:
          - name: jwt
        strip_path: false
        preserve_host: true
      - name: audit-public-schema
        paths:
          - /docs/audit
        methods:
          - GET
        strip_path: true
        preserve_host: true

  - name: calendar-service
    url: http://calendarapi:8012
    routes:
      - name: calendar-public-auth
        paths:
          - /api/v1/calendar/auth
          - /api/v1/calendar/auth/callback
        strip_path: false
        preserve_host: true
      - name: calendar-protected-events
        paths:
          - /api/v1/calendar/events
        plugins:
          - name: jwt
        strip_path: false
        preserve_host: true
      - name: calendar-public-schema
        paths:
          - /docs/calendar
        methods:
          - GET
        strip_path: true
        preserve_host: true

consumers:
  - username: platform-users-recomeco

jwt_secrets:
  - consumer: platform-users-recomeco
    key: ifsports-recomeco
    algorithm: HS256
    secret: "kM3b-z8RpLqW9vY7xJ4tG6sF2cH1eA5nK0jU8iO-vC7xZ1qP9mL3bE4"
